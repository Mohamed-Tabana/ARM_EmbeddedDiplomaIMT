
#include "SPI_int.h"
#include "Utils.h"

void SPI_vInit()
{
	/*1- CPHA and CPOL CFG*/
	SET_BIT(SPI->SPI_CR1,CPHA);
	SET_BIT(SPI->SPI_CR1,CPOL);
	/*2- select Master*/
	SET_BIT(SPI->SPI_CR1,MSTR);
	/*3- CFG BaudRate*/
	SPI->SPI_CR1 &= ~(0b111 << SPI_BR0);
	SPI->SPI_CR1 &= ~(0b010 << SPI_BR0);
	/*4- MSB first*/
	CLEAR_BIT(SPI->SPI_CR1,LSBFIRST);
	/*5- SSM and ISS CFG*/
	SET_BIT(SPI->SPI_CR1,SSI);
	SET_BIT(SPI->SPI_CR1,SSM);
	/*6- Data length*/
	CLEAR_BIT(SPI->SPI_CR1,DFF); // 8 bit
	/*7- SPI Enable*/
	SET_BIT(SPI->SPI_CR1,SPE);

	GPIO_CFG_t MOSI =
	{
	.PIN_Port=PORTA,
	.PIN_Number=PIN7,
	.PIN_OType=OUTPUT,
	.PIN_OType=PUSH_PULL,
	.PIN_OSpeed=LOW_SPEED,
	.PIN_AF=AF5

	};
	GPIO_CFG_t MISO =
	{

	};
	GPIO_CFG_t SCK =
	{

	};
}
uint16_t SPI_Transceiving(uint16_t copy_u16Data)
{

	while(READ_BIT(SPI->SPI_SR,BSY));
	SPI->SPI_DR=copy_u16Data;
	while(READ_BIT(SPI->SPI_SR,BSY));

	return SPI->SPI_DR;
}
